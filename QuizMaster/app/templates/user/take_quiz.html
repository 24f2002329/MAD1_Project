{% extends "base.html" %}
{% block content %}
<section class="vh-90 content">
    <div class="container my-5">
        <div class="card shadow-lg p-4">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h4>Q.No. {{ current_question_index + 1 }}/{{ questions|length }}</h4>
                </div>
                <div>
                    <h4 id="timer">00:00</h4>
                </div>
            </div>
            <hr>
            <form action="{{ url_for('user.take_quiz', quiz_id=quiz.id) }}" method="POST" id="quiz-form">
                <div>
                    <h5>{{ questions[current_question_index].title }}</h5>
                    <ul class="list-unstyled">
                        {% for option in questions[current_question_index].options %}
                        <li>
                            <input type="radio" name="q{{ questions[current_question_index].id }}" id="option{{ option.id }}" value="{{ option.id }}">
                            <label for="option{{ option.id }}">{{ option.text }}</label>
                        </li>
                        {% endfor %}
                    </ul>
                </div>
                <div class="mt-3 d-flex justify-content-between">
                    <button type="button" class="btn btn-primary" id="prev-question" disabled>Previous</button>
                    <button type="button" class="btn btn-primary" id="next-question">Next</button>
                </div>
                <div class="mt-3 text-center">
                    <button type="submit" class="btn btn-success">Submit Quiz</button>
                </div>
            </form>
        </div>
    </div>
</section>

<script>
    let timerElement = document.getElementById('timer');
    let duration = JSON.parse('{{ quiz.duration|tojson }}') * 60;  // Convert minutes to seconds

    // Timer logic
    function startTimer(duration) {
        let timer = duration, minutes, seconds;
        setInterval(function () {
            minutes = parseInt(timer / 60, 10);
            seconds = parseInt(timer % 60, 10);
            timerElement.textContent = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
            if (--timer < 0) {
                document.getElementById('quiz-form').submit();  // Auto-submit form
            }
        }, 1000);
    }
    startTimer(duration);

    // Pagination logic
    let currentQuestionIndex = 0;
    const questions = JSON.parse('{{ questions|tojson }}');
    document.getElementById('next-question').addEventListener('click', () => {
        // Show the next question
        if (currentQuestionIndex < questions.length - 1) {
            currentQuestionIndex++;
            renderQuestion();
        }
    });

    document.getElementById('prev-question').addEventListener('click', () => {
        // Show the previous question
        if (currentQuestionIndex > 0) {
            currentQuestionIndex--;
            renderQuestion();
        }
    });

    function renderQuestion() {
        // Update question content and options dynamically
        const question = questions[currentQuestionIndex];
        document.querySelector('h5').innerText = question.title;
        // Update options dynamically
    }
</script>
{% endblock %}
